#!/bin/sh

source /init.sh
source /usr/local/share/common.sh

cleanup() {
  drush state:set system.maintenance_mode 0 --input-format=integer
}

# Enable maintenance mode.
drush state:set system.maintenance_mode 1 --input-format=integer

# Clear maintenance mode on EXIT.
trap cleanup EXIT

# This script will be the default ENTRYPOINT for post db replace job pod.
# It sources all files within /hooks/db-replace/* in an alphabetical order
# and then runs `exec` on the given parameter.
if [ -d /hooks/db-replace ]; then
    source_all_files_in_dir /hooks/db-replace
fi

echo "Exec: $@"
exec "$@"
